Liongard Agent Deployment - Universal Edition

ðŸ“– Overview
This script is the Universal solution for deploying the Liongard Agent. It is engineered to be RMM-agnostic, meaning it works flawlessly in ConnectWise Automate, Datto RMM, Kaseya VSA, N-able, Syncro, or even via Group Policy/PDQ Deploy.
Context: Why use this version?
Unlike "RMM-Specific" scripts that rely on dynamic variables (e.g., $env:liongardurl) injected by the RMM tool, this script is standalone. You edit the credentials directly inside the file.
Best for: RMMs with complex variable handling, GPO deployments, or "one-off" installs.
Trade-off: Because credentials are hardcoded, you must create a separate copy of this script file for each Liongard environment you deploy to.

Key Features
Zero Dependencies: No external parameters or RMM variables required.
Smart URL Handling: Automatically sanitizes inputs (strips https://, adds .app.liongard.com).
Robust Environment Support: Handles complex names with spaces or special characters via "Smart Decoding."
Deep Error Analysis: Parses MSI installer logs to translate generic error codes (like 1603) into human-readable issues.

âš ï¸ Security & File Management (Read First)
CRITICAL: Because this script contains hardcoded Access Key Secrets, it must be treated as a sensitive credential file.
ðŸ›¡ï¸ Best Practices for IT Admins
Naming Convention: When saving this file for a specific client, use a clear naming convention to avoid mixing up credentials.
Bad: LiongardInstall.ps1
Good: Liongard_Install_AcmeCorp_Hardcoded.ps1

Storage Location:
Do not store these customized scripts in a public folder or open network share (unless locked down for GPO).
Do not upload the edited script to a public GitHub repository.

Cleanup: If running manually on an endpoint (e.g., via USB), Shift+Delete the script immediately after execution.

âš™ï¸ Configuration Guide
Before deploying, you must edit the Configuration Section at the very top of the script (Lines 10-15).
Open Install-Liongard-Universal.ps1 in a text editor (VS Code, Notepad++, or your RMM Script Editor).
Replace the placeholder text with your actual Liongard instance data.

# =======================================================
# --- CONFIGURATION (EDIT THIS SECTION IN THE ACTUAL SCRIPT) ---
# =======================================================


[string]$Url          = "us1"                       # Subdomain is fine (e.g., "us1")
[string]$AccessKey    = "AKID1234567890"            # Your Liongard Access Key ID
[string]$AccessSecret = "SECRET1234567890ABCDEF"    # Your Liongard Access Key Secret
[string]$Environment  = "Managed Services"          # (Optional) The Environment Name


ðŸ’¡ Advanced Environment Naming
Liongard Environment names often contain spaces, ampersands (&), or commas. Passing these via command line can sometimes cause syntax errors depending on how your RMM parses arguments.
To ensure 100% reliability, this script supports URL Encoded strings.
Tools
Recommended Tool: Encode and Decode - Online
Use this site to convert complex names into "safe" strings.


How it works
You can enter the name in the script in either format. The script's "Smart Decoder" handles both automatically.
Your Environment NameConfiguration Input ($Environment)StatusStandard (Finance Dept)$Environment = "Finance Dept"âœ… WorksEncoded (Finance%20Dept)$Environment = "Finance%20Dept"âœ… Works (Safest for RMMs)Complex (Law & Order, LLC)$Environment = "Law%20%26%20Order%2C%20LLC"âœ… Works (Prevents syntax errors)
ðŸš€ Deployment Scenarios
Scenario A: RMM Deployment (Preferred)
Deploying via your remote management tool (ConnectWise, Datto, Kaseya, etc.).
Difficulty: ðŸŸ¢ Easy
Pros: Zero-touch deployment; works over the internet (no VPN required); logs are usually captured in the RMM console.
Cons: Scalability Friction. Since credentials are inside the file, you must save a unique script for each customer in your RMM library (e.g., 50 customers = 50 scripts).
Tip: If your RMM supports passing "Script Variables" securely, consider using the "Parameter-based" version of this script instead to scale better.


Steps:
Duplicate the script and rename it for your target client (e.g., Liongard Install - Client A).
Edit the $AccessKey and $AccessSecret inside the file for Client A.
Upload to your RMM Script Library.
Schedule: Run Once (or Daily to enforce compliance).
Run As: System or Administrator.

Scenario B: Group Policy (GPO) / PDQ Deploy
Deploying via Active Directory GPO or local deployment tools.
Difficulty: ðŸ”´ Hard (Requires AD/Networking knowledge)
Pros: Excellent for onboarding new devices automatically when they join the domain; does not require an RMM agent to be installed first.
Cons: Requires a secured internal file server; devices must be on the domain network (or VPN); slower feedback loop for errors.

Requirements:
File Server: You must host the .ps1 file on a network share accessible by the Domain Computers group (Read-Only). \\YourDC\NETLOGON\ or \\FileServer\Deploy$ are common choices.
Permissions: The "System" account of the target computer needs read access to that share.

Steps (GPO):
Save the configured script to your network share (e.g., \\dc01\NETLOGON\Liongard_Install.ps1).
Open Group Policy Management and create a new GPO linked to the OU containing the target Computers.
Navigate to: Computer Configuration > Policies > Windows Settings > Scripts (Startup/Shutdown).
Double-click Startup.
Click PowerShell Scripts tab.
Click Add and browse to the UNC path of your script (Do not use a local C: path).
Crucial: Ensure the GPO is enforced and that computers reboot to pick up the script.

Scenario C: Manual "One-Off" Installation
Walking up to a machine or remote controlling it individually.
Difficulty: ðŸŸ¡ Medium (High Effort)
Pros: Instant feedback; great for troubleshooting or testing on a "Golden Image."
Cons: Requires direct local access (or remote control); highly manual; script must be cleaned up manually.

Steps:
Copy the configured script to a USB drive or a temporary folder on the machine.
Right-click the file > Run with PowerShell.
Watch the console window for the "SUCCESS" message.
Delete the script file immediately to protect the embedded credentials.

ðŸ”§ Troubleshooting
If the script fails, it is designed to be "noisy." You will find the evidence locally on the target endpoint.
Log Locations (On the Endpoint)
C:\ProgramData\Liongard\ScriptInstall.log
Check here first. This log contains the logic flow. It will tell you if the download failed, if disk space was low, or if the "Pre-Flight" checks failed.

C:\ProgramData\Liongard\AgentInstall.log
Check here if the script says "Unknown MSI Error". This is the raw log from the Windows Installer.


Common Error Messages
Error MessageLikely CauseSolutionFATAL ERROR: You must edit the CONFIGURATIONThe script was run with default placeholders.Edit the top 5 lines of the script with real data.INPUT ERROR: Invalid CredentialsThe Access Key or Secret is incorrect.Check for extra spaces in your $AccessKey or $AccessSecret variables.Insufficient disk spaceThe drive has < 200MB free.Clear space on the C: drive.Service installed but not runningThe agent installed but cannot reach Liongard.Usually a firewall/DNS issue. Ensure port 443 is open to *.liongard.com.
ðŸ“œ Uninstallation
To remove the agent, you do not need this script. You can simply run this command in PowerShell (Admin):

Get-Package -Name "Liongard Agent" | Uninstall-Package -Force

